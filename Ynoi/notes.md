
# Ynoi 2025 (April Fools Round)

## 牢爱

> 一句话题意：区间立方，区间子集和相等判定。

> 时间限制 500 ms；空间限制 128 MB
> 
> 给定一个长为 $n$ 的序列 $a$，$a_i \in [0,V)$，有 $2$ 种操作：
> - `1 l r`：询问 $[l,r]$ 内是否可以选出两个**非空下标集合** $X,Y$，满足：
>   - $X$ 和 $Y$ 没有交集；
>   - $\sum\limits_{i\in X} (a_i+1)=\sum\limits_{i\in Y}(a_i+1)$；
> - `2 l r` ：对于所有 $l\le i\le r$，$a_i\leftarrow a_i^3\pmod V$。
> 
> $1\le n,m\le 10^5,1\le V\le 1000$。

记区间长为 $L$，那么非空子集数为 $2^L-1$，子集 $S$ 的 $\sum\limits_{i \in S} (a_i+1) \in [1,L \cdot V]$。

- 若 $2^L-1>L\cdot V$，由抽屉原理知存在两个集合 $S,T$，满足和相等（剔除交集，就变成不交了）；
- 否则，我们可以暴力遍历所有子集，注意到 $L\sim \log V$，所以是 $O(2^L)=O(V)$ 的，可以接受；当然也可以用 bitset 优化 01 背包，背包的容量是 $L\cdot V$，遍历 $L$ 次，是 $O(\frac{L^2V}{\omega})=O(\frac{V \log^2 V}{\omega})$。

接下来的问题是如何快速维护 $a_i$。注意到操作 1 我们只需要查询 $\log V$ 个值，所以修改时直接用树状数组维护幂次即可，并预处理 $f_{i,j}$ 表示 $i^{3^{2^j}} \mod V$ 的值。这里的复杂度分别为 $O(\log m\log V)$、$O(\log n)$。

总时间复杂度 $O(V\log m+m(\frac{V \log^2V}{\omega}+\log n+\log m\log V))$，空间复杂度 $O(n+V\log m)$。

## 牢夸

> 一句话题意：区间加，区间最大平均数。

> 时间限制 5000 ms；空间限制 512 MB
>
> 给定一个长为 $n$ 的序列 $a$，共 $m$ 次操作，有两种操作类型：
> - `1 l r x`：将 $a_l,\cdots,a_r$ 加上 $x$；
> - `2 l r`：查询 $\max\limits_{l\le L<R\le r} \frac{\sum_{i=L}^{R} a_i}{R-L+1}$。
>
> $1\le n,m\le 10^6,|a_i|,|x|\le 10^3$。

可以发现, 最优区间的长度不会超过 $3$，否则你把它对半劈开，总有一半 $\ge$ 平均值，答案不劣。

于是我们只需要开两棵线段树，分别记录 $a_i+a_{i+1}$ 以及 $a_i+a_{i+1}+a_{i+2}$ 即可。

时间复杂度 $O((n+m)\log n)$，空间复杂度 $O(n)$。